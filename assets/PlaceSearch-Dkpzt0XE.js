import{u as se,a as te,m as ae,q as re,b as B,d as j,e as le,j as e,H as M,W as h,G as f,T as b,k as ie,t as $,g as q,y as ne}from"./index-BLdSJBwv.js";import{r as n,h as k,k as O,F as ce,N as R,o as P,f as T,s as z,l as oe,q as de,B as ue,p as xe}from"./ui-DVQGuqmb.js";import{u as me}from"./navigationCallback-Dv4a5ajJ.js";import{F as H}from"./Footer-DQJht34C.js";import"./vendor-gH-7aFTg.js";const he=({place:a,onSelect:d,onToggleFavorite:p})=>{const w=c=>{switch(c){case"attraction":return e.jsx(P,{className:"w-5 h-5 text-travel-orange"});case"restaurant":return e.jsx(xe,{className:"w-5 h-5 text-travel-green"});case"hotel":return e.jsx(ue,{className:"w-5 h-5 text-travel-purple"});case"transport":return e.jsx(de,{className:"w-5 h-5 text-travel-blue"});default:return e.jsx(T,{className:"w-5 h-5 text-white/80"})}},u=c=>{switch(c){case"attraction":return"관광지";case"restaurant":return"음식점";case"hotel":return"숙소";case"transport":return"교통";default:return"기타"}};return e.jsx(f,{variant:"light",hoverable:!0,className:"cursor-pointer",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",onClick:()=>d(a),children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[w(a.type),e.jsx("span",{className:"text-xs text-white/60 bg-white/10 px-2 py-1 rounded-full",children:u(a.type)}),a.favorite&&e.jsx(z,{className:"w-4 h-4 text-red-400 fill-current"})]}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-1 truncate",children:a.name}),a.address&&e.jsxs("div",{className:"flex items-center space-x-1 text-white/60 text-sm mb-2",children:[e.jsx(T,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:a.address})]}),a.rating&&a.rating>0&&e.jsxs("div",{className:"flex items-center space-x-1 mb-2",children:[e.jsx(P,{className:"w-4 h-4 text-yellow-400 fill-current"}),e.jsx("span",{className:"text-white/80 text-sm",children:a.rating})]}),a.latitude&&a.longitude&&e.jsxs("div",{className:"flex items-center space-x-1 text-white/50 text-xs mb-2",children:[e.jsx(R,{className:"w-3 h-3"}),e.jsxs("span",{children:[a.latitude.toFixed(6),", ",a.longitude.toFixed(6)]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-white/50",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(oe,{className:"w-3 h-3"}),e.jsxs("span",{children:[a.usage_count||0,"번 사용"]})]}),a.created_at&&e.jsx("span",{children:a.created_at.toDate().toLocaleDateString("ko-KR")})]})]}),e.jsx("button",{onClick:c=>{c.stopPropagation(),p(a)},className:"ml-2 p-2 hover:bg-white/10 rounded-lg transition-colors",children:e.jsx(z,{className:`w-5 h-5 ${a.favorite?"text-red-400 fill-current":"text-white/40"}`})})]})})},be=()=>{const{user:a}=se(),d=te(),[p]=ae(),{smartGoBack:w}=me(p),u=p.get("trip"),[c,U]=n.useState([]),[x,G]=n.useState(""),[v,Q]=n.useState("all"),[N,W]=n.useState("recent"),[K,_]=n.useState(!0),[F,g]=n.useState(!1),[I,i]=n.useState(null),[L,m]=n.useState(null),[y,D]=n.useState(!1),[r,o]=n.useState({name:"",address:"",type:"attraction",rating:0,latitude:"",longitude:""}),E=[{value:"all",label:"전체",icon:"📍"},{value:"attraction",label:"관광지",icon:"🏛️"},{value:"restaurant",label:"음식점",icon:"🍽️"},{value:"hotel",label:"숙소",icon:"🏨"},{value:"transport",label:"교통",icon:"🚗"},{value:"other",label:"기타",icon:"📍"}],V=[{value:"recent",label:"최근 추가순"},{value:"favorite",label:"즐겨찾기"},{value:"usage",label:"자주 사용"}];n.useEffect(()=>{if(!a)return;const s=re(B(j,"users",a.uid,"places"));return le(s,l=>{const C=l.docs.map(A=>({id:A.id,...A.data()}));U(C),_(!1)},l=>{console.error("Places 로딩 실패:",l),_(!1)})},[a]);const S=n.useMemo(()=>{let s=c;if(x.trim()){const t=x.toLowerCase().trim();s=s.filter(l=>l.name.toLowerCase().includes(t)||l.address&&l.address.toLowerCase().includes(t))}return v!=="all"&&(s=s.filter(t=>t.type===v)),s.sort((t,l)=>{switch(N){case"favorite":return t.favorite&&!l.favorite?-1:!t.favorite&&l.favorite?1:(l.usage_count||0)-(t.usage_count||0);case"usage":return(l.usage_count||0)-(t.usage_count||0);case"recent":default:return l.created_at.toMillis()-t.created_at.toMillis()}}),s},[c,x,v,N]),J=async s=>{try{if(i(null),await $(q(j,"users",a.uid,"places",s.id),{usage_count:ne(1),last_used:b.now()}),u){const t=new URLSearchParams({place_name:s.name,address:s.address||"",type:s.type,rating:s.rating?.toString()||"0",latitude:s.latitude?.toString()||"",longitude:s.longitude?.toString()||""});d(`/trips/${u}/plans/new?${t.toString()}`)}else w(d,"/")}catch(t){console.error("장소 선택 실패:",t),i("장소 선택 중 오류가 발생했습니다. 다시 시도해주세요."),setTimeout(()=>{u?d(`/trips/${u}/plans/new`):w(d,"/")},2e3)}},X=async s=>{try{i(null),await $(q(j,"users",a.uid,"places",s.id),{favorite:!s.favorite,updated_at:b.now()}),m(s.favorite?"즐겨찾기에서 제거했습니다.":"즐겨찾기에 추가했습니다."),setTimeout(()=>m(null),3e3)}catch(t){console.error("즐겨찾기 토글 실패:",t),i("즐겨찾기 설정 중 오류가 발생했습니다."),setTimeout(()=>i(null),5e3)}},Y=async s=>{if(s.preventDefault(),!(!a||!r.name.trim())){D(!0),i(null);try{const t={name:r.name.trim(),address:r.address.trim()||void 0,type:r.type,rating:r.rating||void 0,latitude:r.latitude?parseFloat(r.latitude):void 0,longitude:r.longitude?parseFloat(r.longitude):void 0,favorite:!1,usage_count:0,created_at:b.now(),updated_at:b.now()};await ie(B(j,"users",a.uid,"places"),t),o({name:"",address:"",type:"attraction",rating:0,latitude:"",longitude:""}),g(!1),m("새 장소가 성공적으로 추가되었습니다!"),setTimeout(()=>m(null),3e3)}catch(t){console.error("새 장소 추가 실패:",t),i("장소 추가 중 오류가 발생했습니다. 다시 시도해주세요."),setTimeout(()=>i(null),5e3)}finally{D(!1)}}},Z=()=>{if(!navigator.geolocation){i("이 브라우저에서는 위치 서비스를 지원하지 않습니다.");return}i(null),navigator.geolocation.getCurrentPosition(s=>{const{latitude:t,longitude:l}=s.coords;o(C=>({...C,latitude:t.toString(),longitude:l.toString()})),m("현재 위치가 설정되었습니다."),setTimeout(()=>m(null),3e3)},s=>{console.error("위치 정보 가져오기 실패:",s);let t="위치 정보를 가져올 수 없습니다.";switch(s.code){case s.PERMISSION_DENIED:t="위치 접근 권한이 거부되었습니다.";break;case s.POSITION_UNAVAILABLE:t="위치 정보를 사용할 수 없습니다.";break;case s.TIMEOUT:t="위치 정보 요청이 시간 초과되었습니다.";break}i(t),setTimeout(()=>i(null),5e3)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})},ee=()=>e.jsx(f,{variant:"light",className:"animate-pulse",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("div",{className:"w-5 h-5 bg-white/20 rounded"}),e.jsx("div",{className:"w-16 h-6 bg-white/20 rounded-full"})]}),e.jsx("div",{className:"w-3/4 h-6 bg-white/20 rounded mb-2"}),e.jsx("div",{className:"w-1/2 h-4 bg-white/20 rounded mb-2"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"w-20 h-4 bg-white/20 rounded"}),e.jsx("div",{className:"w-24 h-4 bg-white/20 rounded"})]})]}),e.jsx("div",{className:"ml-2 w-9 h-9 bg-white/20 rounded-lg"})]})});return K?e.jsxs("div",{className:"min-h-screen",children:[e.jsx(M,{}),e.jsx("div",{className:"pt-20 px-4 pb-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-white text-center flex-1 text-glow",children:"장소 검색"}),e.jsx("div",{className:"w-10 h-10 bg-white/20 rounded-lg animate-pulse"})]}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"w-full h-12 bg-white/10 rounded-xl animate-pulse"})}),e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsx("div",{className:"flex space-x-2 overflow-x-auto pb-2",children:[1,2,3,4,5].map(s=>e.jsx("div",{className:"flex-shrink-0 w-20 h-10 bg-white/10 rounded-lg animate-pulse"},s))}),e.jsx("div",{className:"flex space-x-2",children:[1,2,3].map(s=>e.jsx("div",{className:"w-24 h-10 bg-white/10 rounded-lg animate-pulse"},s))})]}),e.jsx("div",{className:"space-y-4",children:[1,2,3,4,5].map(s=>e.jsx(ee,{},s))})]})}),e.jsx(H,{})]}):e.jsxs("div",{className:"min-h-screen",children:[e.jsx(M,{}),e.jsx("div",{className:"pt-20 px-4 pb-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-white text-center flex-1 text-glow",children:"장소 검색"}),e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>g(!F),className:"!p-2",children:e.jsx(k,{className:"w-5 h-5"})})]}),I&&e.jsx("div",{className:"mb-4 p-4 bg-red-500/20 border border-red-500/50 rounded-xl text-red-200 text-sm",children:I}),L&&e.jsx("div",{className:"mb-4 p-4 bg-green-500/20 border border-green-500/50 rounded-xl text-green-200 text-sm",children:L}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(O,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-white/50"}),e.jsx("input",{type:"text",value:x,onChange:s=>G(s.target.value),placeholder:"장소명이나 주소로 검색...",className:"w-full pl-12 pr-4 py-3 bg-glass-light backdrop-blur-sm border border-white/20 rounded-xl text-white placeholder-white/50 focus:outline-none focus:border-primary-300 focus:ring-1 focus:ring-primary-300"})]})}),e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(ce,{className:"w-4 h-4 text-white/60"}),e.jsx("span",{className:"text-white/60 text-sm",children:"유형"})]}),e.jsx("div",{className:"flex space-x-2 overflow-x-auto pb-2",children:E.map(s=>e.jsxs("button",{onClick:()=>Q(s.value),className:`flex-shrink-0 px-3 py-2 rounded-lg text-sm transition-all ${v===s.value?"bg-primary-500 text-white":"bg-white/10 text-white/70 hover:bg-white/20"}`,children:[s.icon," ",s.label]},s.value))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center space-x-2 mb-2",children:e.jsx("span",{className:"text-white/60 text-sm",children:"정렬"})}),e.jsx("div",{className:"flex space-x-2",children:V.map(s=>e.jsx("button",{onClick:()=>W(s.value),className:`px-3 py-2 rounded-lg text-sm transition-all ${N===s.value?"bg-primary-500 text-white":"bg-white/10 text-white/70 hover:bg-white/20"}`,children:s.label},s.value))})]})]}),F&&e.jsxs(f,{variant:"travel",className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"새 장소 추가"}),e.jsxs("form",{onSubmit:Y,className:"space-y-4",children:[e.jsx("div",{children:e.jsx("input",{type:"text",value:r.name,onChange:s=>o({...r,name:s.target.value}),placeholder:"장소명 *",className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-white/50 focus:outline-none focus:border-primary-300 focus:ring-1 focus:ring-primary-300",required:!0})}),e.jsx("div",{children:e.jsx("input",{type:"text",value:r.address,onChange:s=>o({...r,address:s.target.value}),placeholder:"주소",className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-white/50 focus:outline-none focus:border-primary-300 focus:ring-1 focus:ring-primary-300"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-white/70 text-sm",children:"위치 좌표 (선택사항)"}),e.jsx(h,{type:"button",variant:"ghost",size:"sm",onClick:Z,className:"!p-2",title:"현재 위치 가져오기",children:e.jsx(R,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx("input",{type:"number",step:"any",value:r.latitude,onChange:s=>o({...r,latitude:s.target.value}),placeholder:"위도 (latitude)",className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-white/50 focus:outline-none focus:border-primary-300 focus:ring-1 focus:ring-primary-300"})}),e.jsx("div",{children:e.jsx("input",{type:"number",step:"any",value:r.longitude,onChange:s=>o({...r,longitude:s.target.value}),placeholder:"경도 (longitude)",className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-white/50 focus:outline-none focus:border-primary-300 focus:ring-1 focus:ring-primary-300"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx("select",{value:r.type,onChange:s=>o({...r,type:s.target.value}),className:"px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white focus:outline-none focus:border-primary-300 focus:ring-1 focus:ring-primary-300",children:E.filter(s=>s.value!=="all").map(s=>e.jsx("option",{value:s.value,className:"bg-primary-800",children:s.label},s.value))}),e.jsx("div",{className:"flex items-center space-x-2",children:[1,2,3,4,5].map(s=>e.jsx("button",{type:"button",onClick:()=>o({...r,rating:s}),className:`w-6 h-6 ${s<=r.rating?"text-yellow-400":"text-white/30"}`,children:e.jsx(P,{className:"w-6 h-6 fill-current"})},s))})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(h,{type:"submit",variant:"travel",size:"sm",className:"flex-1",disabled:y||!r.name.trim(),children:y?"추가 중...":"추가"}),e.jsx(h,{type:"button",variant:"ghost",size:"sm",onClick:()=>g(!1),disabled:y,children:"취소"})]})]})]}),e.jsx("div",{className:"space-y-4",children:S.length===0?e.jsx(f,{variant:"light",className:"text-center py-8",children:x.trim()?e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"w-16 h-16 text-white/40 mx-auto mb-4"}),e.jsxs("p",{className:"text-white/60 mb-4",children:["'",x,"'에 대한 검색 결과가 없습니다"]}),e.jsxs(h,{variant:"travel",onClick:()=>g(!0),children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"새 장소 추가"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-16 h-16 text-white/40 mx-auto mb-4"}),e.jsx("p",{className:"text-white/60 mb-4",children:"저장된 장소가 없어요"}),e.jsxs(h,{variant:"travel",onClick:()=>g(!0),children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"첫 번째 장소 추가"]})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-white/60 text-sm mb-2",children:[S.length,"개의 장소"]}),S.map(s=>e.jsx(he,{place:s,onSelect:J,onToggleFavorite:X},s.id))]})})]})}),e.jsx(H,{})]})};export{be as PlaceSearch};
//# sourceMappingURL=PlaceSearch-Dkpzt0XE.js.map
