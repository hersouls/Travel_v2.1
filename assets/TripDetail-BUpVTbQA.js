import{l as H,u as K,a as R,v as Y,e as E,g as z,q as J,w as O,b as V,j as e,G as p,W as h,H as X,d as y,f as Z}from"./index-BLdSJBwv.js";import{r as x,A as ee,e as F,I as te,f as se,C as L,h as T}from"./ui-DVQGuqmb.js";import{N as U,D as g}from"./navigationCallback-Dv4a5ajJ.js";import{F as ae}from"./Footer-DQJht34C.js";import{P as re}from"./PlanCard-Y2tcHdVn.js";import"./vendor-gH-7aFTg.js";const me=()=>{const{id:n}=H(),{user:v}=K(),d=R(),u=Y(),[a,A]=x.useState(null),[D,W]=x.useState([]),[I,j]=x.useState(!0),[k,b]=x.useState(null),[i,C]=x.useState(1);if(x.useEffect(()=>{if(!n||!v)return;const t=E(z(y,"trips",n),l=>{if(l.exists()){const o={id:l.id,...l.data()};if(o.user_id!==v.uid){b("접근 권한이 없습니다."),j(!1);return}A(o)}else b("여행을 찾을 수 없습니다.");j(!1)},l=>{console.error("Trip 로딩 실패:",l),b("여행 데이터를 불러오는데 실패했습니다."),j(!1)}),s=J(V(y,"plans"),O("trip_id","==",n)),r=E(s,l=>{const f=l.docs.map(c=>({id:c.id,...c.data()})).sort((c,m)=>c.day!==m.day?c.day-m.day:c.start_time.localeCompare(m.start_time));W(f)},l=>{console.error("Plans 로딩 실패:",l)});return()=>{t(),r()}},[n,v]),x.useEffect(()=>{if(u.hash&&a){const t=u.hash.match(/^#day-(\d+)$/);if(t){const s=parseInt(t[1]),r=w();s>=1&&s<=r&&(C(s),window.history.replaceState(null,"",u.pathname))}}},[u.hash,a]),I)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"text-white text-lg",children:"로딩 중..."})});if(k||!a)return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-6",children:e.jsxs(p,{variant:"travel",className:"text-center",children:[e.jsx("p",{className:"text-white mb-4",children:k||"여행을 찾을 수 없습니다."}),e.jsx(h,{onClick:()=>d("/"),children:"Back"})]})});const $=t=>new Date(t).toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric"}),P=t=>{if(!t)return"";const[s,r,l]=t.split("-"),o=new Date(Number(s),Number(r)-1,Number(l)),c=["일","월","화","수","목","금","토"][o.getDay()],m=r.padStart(2,"0"),G=l.padStart(2,"0");return`${s}.${m}.${G}.${c}`},w=()=>{const t=new Date(a.start_date),s=new Date(a.end_date),r=Math.abs(s.getTime()-t.getTime());return Math.ceil(r/(1e3*60*60*24))+1},S=t=>{if(!a)return`Day ${t}`;const s=new Date(a.start_date),r=new Date(s);r.setDate(s.getDate()+t-1);const l=r.getFullYear(),o=String(r.getMonth()+1).padStart(2,"0"),f=String(r.getDate()).padStart(2,"0"),m=["일","월","화","수","목","금","토"][r.getDay()];return`${l}.${o}.${f}.${m}`},N=t=>D.filter(s=>s.day===t),M=Array.from({length:w()},(t,s)=>s+1),_=()=>{const t=g.createDayCallback(`/trips/${n}/plans/new?day=${i}`,n,i);d(t)},q=t=>{const s=g.createDayCallback(`/trips/${n}/plans/${t.id}`,n,i);d(s)},B=t=>{const s=g.createDayCallback(`/trips/${n}/plans/${t.id}`,n,i);d(s)},Q=async t=>{if(t.id)try{await Z(z(y,"plans",t.id))}catch(s){console.error("일정 삭제 실패:",s),alert("일정 삭제에 실패했습니다.")}};return e.jsxs("div",{className:"min-h-screen",children:[e.jsx(X,{}),e.jsx("div",{className:"pt-20 px-4 pb-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"mb-4",children:e.jsxs(h,{variant:"ghost",size:"sm",onClick:()=>d("/"),className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4"}),"Back"]})}),e.jsxs(p,{variant:"travel",withWaveEffect:!0,hoverable:!0,className:"mb-6 animate-fade-in wave-optimized",style:{animationDelay:"0.1s"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-white moonwave-glow break-words",children:a.title}),e.jsxs("p",{className:"text-white/60 text-sm mt-1",children:[P(a.start_date)," ~ ",P(a.end_date)]})]}),e.jsxs(h,{variant:"ghost",size:"sm",onClick:()=>{const t=U.createCallbackFromCurrent(`/trips/${a.id}/edit`,{preserveQuery:!0,preserveFragment:!0,contextData:{selectedDay:i,tripId:a.id}});d(t)},className:"flex items-center gap-2 hover:bg-white/10",ariaLabel:"여행 수정",children:[e.jsx(F,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"수정"})]})]}),e.jsxs("div",{className:"relative w-full h-48 md:h-56 lg:h-64 mb-4 rounded-xl overflow-hidden bg-gradient-to-br from-travel-blue/20 to-travel-purple/20",children:[a.cover_image?e.jsx("img",{src:a.cover_image,alt:a.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(te,{className:"w-16 h-16 text-white/60"})}),e.jsx("div",{className:"absolute top-2 right-2 sm:top-3 sm:right-3 opacity-80 sm:opacity-60 hover:opacity-100 transition-opacity",children:e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>{const t=U.createCallbackFromCurrent(`/trips/${a.id}/edit`,{preserveQuery:!0,preserveFragment:!0,contextData:{selectedDay:i,tripId:a.id}});d(t)},className:"p-2 rounded-lg bg-black/30 hover:bg-black/50 backdrop-blur-sm",ariaLabel:"이미지 수정",children:e.jsx(F,{className:"w-3 h-3 text-white"})})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-white/80",children:[e.jsx(se,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm md:text-base",children:a.country})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-white/80",children:[e.jsx(L,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm md:text-base",children:[$(a.start_date)," ~ ",$(a.end_date)]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 pt-2 border-t border-white/10",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-white/60 text-sm md:text-base",children:"총 기간"}),e.jsxs("span",{className:"text-travel-blue font-semibold text-sm md:text-base",children:[w(),"일"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-white/60 text-sm md:text-base",children:"일정 개수"}),e.jsxs("span",{className:"text-travel-orange font-semibold text-sm md:text-base",children:[D.length,"개"]})]})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx(p,{variant:"light",withWaveEffect:!0,hoverable:!1,className:"mb-4 animate-fade-in",style:{animationDelay:"0.2s"},children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-white",children:"일정"}),e.jsx("p",{className:"text-white/60 text-sm mt-1",children:"일정 카드를 클릭하거나 편집 버튼으로 수정할 수 있습니다"})]}),e.jsxs(h,{variant:"travel",size:"sm",onClick:_,className:"wave-optimized",children:[e.jsx(T,{className:"w-4 h-4 mr-1"}),"추가"]})]})}),e.jsx(p,{variant:"light",className:"animate-fade-in",style:{animationDelay:"0.3s"},children:e.jsx("div",{className:"flex space-x-2 overflow-x-auto pb-2",children:M.map(t=>{const s=N(t);return e.jsx("button",{id:`day-tab-${t}`,onClick:()=>C(t),className:`relative flex-shrink-0 px-3 md:px-4 py-2 rounded-lg text-sm md:text-base font-medium transition-all wave-float ${i===t?"bg-primary-500 text-white shadow-lg shadow-primary-500/25":"bg-white/10 text-white/70 hover:bg-white/20 hover:scale-105"}`,children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"font-semibold",children:["Day ",t]}),s.length>0&&e.jsx("span",{className:"text-xs bg-white/20 rounded-full px-1.5",children:s.length})]}),e.jsx("span",{className:"text-xs opacity-80",children:S(t)})]})},t)})})})]}),e.jsx("div",{className:"space-y-4",children:N(i).length===0?e.jsxs(p,{variant:"light",withWaveEffect:!0,className:"text-center py-8 animate-fade-in wave-optimized",style:{animationDelay:"0.4s"},children:[e.jsx(L,{className:"w-16 h-16 text-white/40 mx-auto mb-4 wave-pulse"}),e.jsxs("p",{className:"text-white/60 mb-4",children:["Day ",i," (",S(i),")에 일정이 없어요"]}),e.jsxs(h,{variant:"travel",onClick:_,className:"wave-optimized",children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"첫 번째 일정 추가"]})]}):N(i).map((t,s)=>e.jsx("div",{className:"animate-fade-in",style:{animationDelay:`${.4+s*.1}s`},children:e.jsx(re,{plan:t,onClick:()=>q(t),onEdit:()=>B(t),onDelete:()=>Q(t),showActions:!0,className:"wave-optimized"})},t.id))})]})}),e.jsx(ae,{})]})};export{me as TripDetail};
//# sourceMappingURL=TripDetail-BUpVTbQA.js.map
