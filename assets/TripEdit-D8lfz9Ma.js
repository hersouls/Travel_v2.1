import{u as q,a as J,l as Q,m as V,j as e,G as p,W as m,H as Y,n as Z,g as S,d as L,r as ee,s as te,h as ae,i as se,T as re,p as le,t as ie}from"./index-bOpXNAIh.js";import{r as o,j as ne,T as I,X as oe,i as ce,f as de,C as N}from"./ui-DVQGuqmb.js";import{u as me}from"./navigationCallback-Dv4a5ajJ.js";import{F as xe}from"./Footer-BLBwfgQj.js";import"./vendor-gH-7aFTg.js";const ve=()=>{const{user:x}=q(),f=J(),{id:j}=Q(),[$]=V(),{hasCallback:E,executeCallback:P,smartGoBack:F}=me($),[t,u]=o.useState({title:"",country:"",start_date:"",end_date:""}),[n,B]=o.useState(null),[i,g]=o.useState(null),[y,h]=o.useState(null),[d,b]=o.useState(!1),[w,_]=o.useState(!1),[M,D]=o.useState(!0),[v,l]=o.useState(null),R=["대한민국","일본","중국","미국","영국","프랑스","독일","이탈리아","스페인","캐나다","호주","태국","베트남","싱가포르","말레이시아","인도네시아","필리핀","인도","브라질","아르헨티나","기타"],C=a=>{if(!a)return"";const[s,r,c]=a.split("-"),k=new Date(Number(s),Number(r)-1,Number(c)),O=["일","월","화","수","목","금","토"][k.getDay()],K=r.padStart(2,"0"),X=c.padStart(2,"0");return`${s}.${K}.${X}.${O}`};o.useEffect(()=>{(async()=>{if(!(!j||!x))try{const s=await Z(S(L,"trips",j));if(s.exists()){const r={id:s.id,...s.data()};if(r.user_id!==x.uid){l("접근 권한이 없습니다."),D(!1);return}B(r),u({title:r.title,country:r.country,start_date:r.start_date,end_date:r.end_date}),r.cover_image&&h(r.cover_image)}else l("여행을 찾을 수 없습니다.")}catch(s){console.error("여행 로드 실패:",s),l("여행 데이터를 불러오는데 실패했습니다.")}finally{D(!1)}})()},[j,x]);const T=a=>{const s=a.target.files?.[0];if(s){if(s.size>5*1024*1024){l("이미지 크기는 5MB를 초과할 수 없습니다.");return}g(s);const r=new FileReader;r.onload=c=>{h(c.target?.result)},r.readAsDataURL(s),b(!1),l(null)}},U=()=>{g(null),h(n?.cover_image||null),b(!1)},W=()=>{g(null),h(null),b(!0)},z=()=>{g(null),h(n?.cover_image||null),b(!1)},G=()=>{if(t.start_date&&t.end_date){const a=new Date(t.start_date),s=new Date(t.end_date),r=Math.abs(s.getTime()-a.getTime());return Math.ceil(r/(1e3*60*60*24))+1}return 0},A=()=>t.title.trim()?t.title.length<2||t.title.length>60?(l("여행 제목은 2-60자 사이여야 합니다."),!1):t.country?!t.start_date||!t.end_date?(l("여행 날짜를 선택해주세요."),!1):new Date(t.start_date)>new Date(t.end_date)?(l("시작 날짜가 종료 날짜보다 늦을 수 없습니다."),!1):!0:(l("국가를 선택해주세요."),!1):(l("여행 제목을 입력해주세요."),!1),H=async a=>{if(a.preventDefault(),!(!x||!n||!A())){_(!0),l(null);try{let s=n.cover_image||"";if(i){const c=ee(te,`trip-covers/${x.uid}/${Date.now()}_${i.name}`),k=await ae(c,i);s=await se(k.ref)}const r={title:t.title.trim(),country:t.country,start_date:t.start_date,end_date:t.end_date,updated_at:re.now()};d?r.cover_image=le():i&&(r.cover_image=s),await ie(S(L,"trips",n.id),r),E?P(f):f(`/trips/${n.id}`)}catch(s){console.error("여행 수정 실패:",s),l("여행 수정에 실패했습니다. 다시 시도해주세요.")}finally{_(!1)}}};return M?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"text-white text-lg",children:"여행 정보 로딩 중..."})}):v&&!n?e.jsx("div",{className:"min-h-screen flex items-center justify-center p-6",children:e.jsxs(p,{variant:"travel",className:"text-center",children:[e.jsx("p",{className:"text-white mb-4",children:v}),e.jsx(m,{onClick:()=>f("/"),children:"홈으로 돌아가기"})]})}):e.jsxs("div",{className:"min-h-screen",children:[e.jsx(Y,{}),e.jsx("div",{className:"pt-20 px-4 pb-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-6 animate-fade-in",children:[e.jsx("h1",{className:"text-2xl-ko md:text-3xl-ko lg:text-4xl-ko xl:text-5xl-ko font-bold text-white moonwave-glow break-keep-ko",children:"여행 수정하기"}),e.jsx("p",{className:"text-sm-ko md:text-base-ko lg:text-lg-ko xl:text-xl-ko text-white/60 mt-2 tracking-ko-normal",children:"여행 정보를 업데이트하세요"})]}),e.jsxs("form",{onSubmit:H,className:"w-full space-y-6",children:[e.jsxs(p,{variant:"travel",withWaveEffect:!0,hoverable:!0,className:"animate-fade-in wave-optimized",style:{animationDelay:"0.1s"},children:[e.jsx("h3",{className:"text-lg-ko font-semibold text-white mb-4 tracking-ko-normal",children:"커버 이미지"}),y?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:y,alt:"커버 이미지 미리보기",className:"w-full h-40 md:h-48 lg:h-56 object-cover rounded-xl"}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-2",children:[e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("div",{className:"inline-flex items-center justify-center p-2 rounded-full bg-blue-500/20 hover:bg-blue-500/40 backdrop-blur-sm transition-all duration-300 wave-float",children:e.jsx(ne,{className:"w-4 h-4 text-blue-300"})}),e.jsx("input",{type:"file",accept:"image/*",onChange:T,className:"hidden"})]}),e.jsx(m,{type:"button",onClick:W,variant:"secondary",size:"sm",className:"!p-2 !px-2 !py-2 rounded-full bg-red-500/20 hover:bg-red-500/40 backdrop-blur-sm",ariaLabel:"이미지 삭제",children:e.jsx(I,{className:"w-4 h-4 text-red-300"})}),(i||d)&&e.jsx(m,{type:"button",onClick:i?U:z,variant:"secondary",size:"sm",className:"!p-2 !px-2 !py-2 rounded-full bg-white/20 hover:bg-white/40 backdrop-blur-sm",ariaLabel:i?"새 이미지 취소":"원본으로 복원",children:e.jsx(oe,{className:"w-4 h-4 text-white"})})]}),e.jsxs("div",{className:"absolute bottom-2 left-2",children:[i&&e.jsx("div",{className:"bg-green-500/20 backdrop-blur-sm rounded-full px-3 py-1 text-xs text-green-300",children:"새 이미지"}),d&&!i&&e.jsx("div",{className:"bg-red-500/20 backdrop-blur-sm rounded-full px-3 py-1 text-xs text-red-300",children:"삭제 예정"}),!i&&!d&&n?.cover_image&&e.jsx("div",{className:"bg-blue-500/20 backdrop-blur-sm rounded-full px-3 py-1 text-xs text-blue-300",children:"기존 이미지"})]})]}):e.jsxs("div",{className:"space-y-4",children:[d&&e.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded-xl p-4 text-center",children:[e.jsx(I,{className:"w-8 h-8 text-red-400 mx-auto mb-2"}),e.jsx("p",{className:"text-red-300 text-sm",children:"커버 이미지가 삭제됩니다"}),e.jsx(m,{type:"button",onClick:z,variant:"ghost",size:"sm",className:"mt-2 text-red-300 hover:text-red-200",children:"삭제 취소"})]}),e.jsxs("label",{className:"block w-full h-40 md:h-48 lg:h-56 border-2 border-dashed border-white/30 rounded-xl cursor-pointer hover:border-white/50 transition-colors touch-optimized wave-float",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-white/60 hover:text-white/80",children:[e.jsx(ce,{className:"w-8 h-8 mb-2 wave-pulse"}),e.jsx("span",{className:"text-sm-ko tracking-ko-normal",children:d?"새 이미지 업로드":"이미지 업로드"}),e.jsx("span",{className:"text-xs-ko mt-1 text-white/40",children:"최대 5MB"})]}),e.jsx("input",{type:"file",accept:"image/*",onChange:T,className:"hidden"})]})]})]}),e.jsx(p,{variant:"travel",withWaveEffect:!0,hoverable:!0,className:"animate-fade-in wave-optimized",style:{animationDelay:"0.2s"},children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-white text-sm-ko font-medium mb-2 tracking-ko-normal",children:"여행 제목 *"}),e.jsx("input",{type:"text",value:t.title,onChange:a=>u({...t,title:a.target.value}),placeholder:"예: 도쿄 벚꽃 여행",maxLength:60,className:"w-full px-4 py-3 bg-glass-light backdrop-blur-sm border border-white/20 rounded-xl text-white placeholder-white/50 focus:outline-none focus:border-primary-300 focus:ring-1 focus:ring-primary-300 touch-optimized transition-all"}),e.jsxs("div",{className:"text-xs-ko text-white/60 mt-1 text-numeric",children:[t.title.length,"/60자"]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-white text-sm-ko font-medium mb-2 tracking-ko-normal",children:[e.jsx(de,{className:"w-4 h-4 inline mr-1"}),"국가 *"]}),e.jsxs("select",{value:t.country,onChange:a=>u({...t,country:a.target.value}),className:"w-full px-4 py-3 bg-glass-light backdrop-blur-sm border border-white/20 rounded-xl text-white focus:outline-none focus:border-primary-300 focus:ring-1 focus:ring-primary-300 touch-optimized transition-all",children:[e.jsx("option",{value:"",disabled:!0,children:"국가를 선택해주세요"}),R.map(a=>e.jsx("option",{value:a,className:"bg-primary-800 text-base-ko",children:a},a))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-white text-sm-ko font-medium mb-2 tracking-ko-normal",children:[e.jsx(N,{className:"w-4 h-4 inline mr-1"}),"시작일 *"]}),e.jsx("input",{type:"date",value:t.start_date,onChange:a=>u({...t,start_date:a.target.value}),className:"w-full px-4 py-3 bg-glass-light backdrop-blur-sm border border-white/20 rounded-xl text-white focus:outline-none focus:border-primary-300 focus:ring-1 focus:ring-primary-300 touch-optimized transition-all text-numeric"}),t.start_date&&e.jsx("div",{className:"text-xs-ko text-white/60 mt-1",children:C(t.start_date)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white text-sm-ko font-medium mb-2 tracking-ko-normal",children:"종료일 *"}),e.jsx("input",{type:"date",value:t.end_date,onChange:a=>u({...t,end_date:a.target.value}),min:t.start_date,className:"w-full px-4 py-3 bg-glass-light backdrop-blur-sm border border-white/20 rounded-xl text-white focus:outline-none focus:border-primary-300 focus:ring-1 focus:ring-primary-300 touch-optimized transition-all text-numeric"}),t.end_date&&e.jsx("div",{className:"text-xs-ko text-white/60 mt-1",children:C(t.end_date)})]})]}),t.start_date&&t.end_date&&e.jsx(p,{variant:"light",className:"animate-fade-in moonwave-glow",children:e.jsxs("p",{className:"text-white text-sm-ko text-center tracking-ko-normal",children:[e.jsx(N,{className:"w-4 h-4 inline mr-1"}),"총 ",e.jsxs("span",{className:"font-bold text-travel-blue text-numeric",children:[G(),"일"]})," 여행"]})})]})}),v&&e.jsx(p,{variant:"strong",className:"animate-fade-in wave-pulse",children:e.jsx("p",{className:"text-error-foreground text-sm-ko text-center tracking-ko-normal break-keep-ko",children:v})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(m,{type:"button",variant:"ghost",size:"lg",onClick:()=>F(f,`/trips/${n?.id}`),className:"flex-1 animate-fade-in touch-optimized",style:{animationDelay:"0.3s"},ariaLabel:"취소",children:"취소"}),e.jsx(m,{type:"submit",variant:"travel",size:"lg",className:"flex-1 animate-fade-in touch-optimized wave-optimized group relative overflow-hidden",style:{animationDelay:"0.3s"},disabled:w,ariaLabel:w?"여행 수정 중":"여행 수정하기",children:w?e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-white/30 border-t-white rounded-full"}),e.jsx("span",{className:"text-base-ko tracking-ko-normal",children:"수정 중..."})]}):e.jsxs("span",{className:"text-base-ko tracking-ko-normal flex items-center justify-center space-x-2 group-hover:scale-105 transition-transform",children:[e.jsx("span",{children:"수정하기"}),e.jsx(N,{className:"w-4 h-4 group-hover:rotate-12 transition-transform"})]})})]})]})]})}),e.jsx(xe,{})]})};export{ve as TripEdit};
//# sourceMappingURL=TripEdit-D8lfz9Ma.js.map
